<div class="main-wrapper d-flex flex-column min-vh-100">

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark gradient-bg shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold d-flex align-items-center" href="#">
        <i class="bi bi-people-fill me-2"></i> Employee Portal
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><button class="btn nav-link" (click)="setView('dashboard')"><i class="bi bi-house-door me-1"></i> Dashboard</button></li>
          <li class="nav-item"><button class="btn nav-link" (click)="setView('apply')"><i class="bi bi-file-earmark-plus me-1"></i> Apply Leave</button></li>
          <li class="nav-item"><button class="btn nav-link" (click)="setView('myLeaves')"><i class="bi bi-card-checklist me-1"></i> My Leaves</button></li>
          
          <li class="nav-item"><button class="btn nav-link" (click)="setView('balances')"><i class="bi bi-graph-up me-1"></i> Balances</button></li>
        </ul>
        <span class="navbar-text me-3">ðŸ‘‹ Hi, <strong>{{ username }}</strong></span>
        <button class="btn btn-light btn-sm px-3" (click)="confirmLogout()"><i class="bi bi-box-arrow-right"></i> Logout</button>
      </div>
    </div>
  </nav>

  <!-- CONTAINER BODY -->
  <div class="container my-4 flex-grow-1">

    <!-- Dashboard View -->
    <div *ngIf="currentView === 'dashboard'" class="dashboard-card p-5 text-center">
      <h2 class="fw-bold mb-3">Welcome, {{ username }} ðŸŽ‰</h2>
      <p class="lead">Manage your leave requests with ease. Select an option below:</p>
      <div class="d-flex flex-wrap justify-content-center gap-3 mt-4">
        <button class="btn btn-success btn-lg dash-btn" (click)="setView('apply')"><i class="bi bi-file-earmark-plus"></i> Apply Leave</button>
        <button class="btn btn-info btn-lg text-white dash-btn" (click)="setView('myLeaves')"><i class="bi bi-card-checklist"></i> My Leaves</button>
        
        <button class="btn btn-primary btn-lg dash-btn" (click)="setView('balances')"><i class="bi bi-graph-up"></i> Leave Balances</button>
      </div>
    </div>

    <!-- Apply Leave View -->
    <div *ngIf="currentView === 'apply'" class="card shadow-lg p-4 mb-4 animate-fade">
      <h3 class="fw-bold text-primary"><i class="bi bi-calendar-plus me-2"></i> Apply for Leave</h3>
      <form class="row g-3 mt-2" (ngSubmit)="applyLeave()">
        <div class="col-md-4">
          <label class="form-label">Start Date</label>
          <input [(ngModel)]="newLeave.start_date" name="start_date" type="date" class="form-control" required />
        </div>
        <div class="col-md-4">
          <label class="form-label">End Date</label>
          <input [(ngModel)]="newLeave.end_date" name="end_date" type="date" class="form-control" required />
        </div>
        <!-- Leave Type Dropdown -->
        <div class="col-md-4">
          <label class="form-label">Leave Type</label>
          <select [(ngModel)]="newLeave.leave_type" name="leave_type" class="form-select" required>
            <option value="">-- Select Leave Type --</option>
            <option value="sick">Sick / Casual</option>
            <option value="medical">Medical</option>
            <option value="privileged">Privileged</option>
          </select>
        </div>

        <!-- Reason Textbox -->
        <div class="col-md-12">
          <label class="form-label">Reason</label>
          <textarea [(ngModel)]="newLeave.reason" name="reason" class="form-control" rows="3" placeholder="Enter your reason" required></textarea>
        </div>

        <div class="col-12 mt-3">
          <button type="submit" class="btn btn-primary px-4">Submit Request</button>
        </div>
      </form>
    </div>

    <!-- My Leaves View -->
    <div *ngIf="currentView === 'myLeaves'" class="card shadow-lg p-4 mb-4 animate-fade">
      <h3 class="fw-bold text-info"><i class="bi bi-list-task me-2"></i> My Leave Requests</h3>
      <div class="table-responsive mt-3">
        <table class="table table-hover align-middle">
          <thead class="table-dark">
            <tr><th>ID</th><th>Dates</th><th>Reason</th><th>Status</th><th>Manager Remark</th><th>Action</th></tr>
          </thead>
          <tbody>
            <tr *ngFor="let l of leaves">
              <td>{{ l.id }}</td>
              <td><i class="bi bi-calendar-event"></i> {{ l.start_date }} â†’ {{ l.end_date }}</td>
              <td>{{ l.reason }}<br><small class="text-muted">({{ l.leave_type }})</small></td>
              <td>
                <span class="badge bg-warning text-dark" *ngIf="l.status === 'Pending'">Pending</span>
                <span class="badge bg-success" *ngIf="l.status === 'Approved'">Approved</span>
                <span class="badge bg-danger" *ngIf="l.status === 'Rejected'">Rejected</span>
              </td>
              <td>{{ l.remarks || '-' }}</td>
              <td>
                <button *ngIf="l.status === 'Pending'" class="btn btn-danger btn-sm" (click)="deleteLeave(l.id)">
                  <i class="bi bi-trash"></i> Cancel
                </button>
                <span *ngIf="l.status !== 'Pending'">-</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Approvals View -->
    <div *ngIf="currentView === 'approvals'" class="card shadow-lg p-4 mb-4 animate-fade">
      <h3 class="fw-bold text-warning"><i class="bi bi-clock-history me-2"></i> Approval History</h3>
      <ul class="list-group mt-3">
        <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let l of leaves">
          <span>Leave #{{ l.id }} | <strong>{{ l.status }}</strong></span>
          <span *ngIf="l.remarks" class="text-muted">Remark: {{ l.remarks }}</span>
        </li>
      </ul>
    </div>

    <!-- Leave Balances View -->
    <div *ngIf="currentView === 'balances'" class="animate-fade">
      <!-- Row 1: Balance Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-4">
          <div class="balance-card bg-success text-white"><h4>{{ balance.sick_casual }}</h4><p>Sick/Casual Leaves</p></div>
        </div>
        <div class="col-md-4">
          <div class="balance-card bg-info text-white"><h4>{{ balance.medical }}</h4><p>Medical Leaves</p></div>
        </div>
        <div class="col-md-4">
          <div class="balance-card bg-primary text-white"><h4>{{ balance.privileged }}</h4><p>Privileged Leaves</p></div>
        </div>
      </div>

      <!-- Row 2: Pie Chart -->
      <div class="row">
        <div class="col-12 d-flex justify-content-center">
          <div class="card shadow-sm p-3" style="max-width: 500px; width: 100%;">
            <canvas baseChart
              [data]="pieChartData"
              [options]="pieChartOptions"
              [type]="pieChartType">
            </canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3">
    <div class="toast align-items-center text-bg-success border-0" [class.show]="toastMessage" [class.fade]="true">
      <div class="d-flex">
        <div class="toast-body">{{ toastMessage }}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="toastMessage=''"></button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-dark text-light py-2 mt-auto">
    <div class="container text-center">
      <small>Email: support@employeeportal.com | +91 9876543210</small>
      <div class="mt-2">
        <a href="#" class="text-light me-2"><i class="bi bi-facebook"></i></a>
        <a href="#" class="text-light me-2"><i class="bi bi-twitter"></i></a>
        <a href="#" class="text-light"><i class="bi bi-linkedin"></i></a>
      </div>
      <div class="mt-2">&copy; {{ currentYear }} Leave Management System</div>
    </div>
  </footer>

</div>
