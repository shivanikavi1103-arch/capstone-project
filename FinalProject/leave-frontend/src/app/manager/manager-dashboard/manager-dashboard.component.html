<div class="main-wrapper d-flex flex-column min-vh-100">

  <nav class="navbar navbar-expand-lg navbar-dark gradient-bg shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">
        <i class="bi bi-speedometer2 me-2"></i> Manager Panel
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarMenu">
        <ul class="navbar-nav me-auto mb-2">
          <li class="nav-item"><button class="btn btn-link nav-link" (click)="setView('dashboard')">Dashboard</button></li>
          <li class="nav-item"><button class="btn btn-link nav-link" (click)="setView('approvals')">Pending Approvals</button></li>
          <li class="nav-item"><button class="btn btn-link nav-link" (click)="setView('all-leaves')">All Leaves</button></li>
          <li class="nav-item"><button class="btn btn-link nav-link" (click)="setView('balances')">Leave Balances</button></li>
          <li class="nav-item"><button class="btn btn-link nav-link" (click)="setView('create-employee')">Employees</button></li>
        </ul>
        <span class="navbar-text me-3 text-white">
          Welcome, <strong>{{ username }}</strong>
        </span>
        <button class="btn btn-outline-light btn-sm" (click)="logout()">Logout</button>
      </div>
    </div>
  </nav>


  <div *ngIf="toastMessage" class="alert alert-success alert-dismissible fade show m-3">
    {{ toastMessage }}
    <button type="button" class="btn-close" (click)="toastMessage = ''"></button>
  </div>
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show m-3">
    {{ error }}
    <button type="button" class="btn-close" (click)="error = ''"></button>
  </div>


  <div class="dashboard-wrapper container my-4 flex-grow-1">


    <div *ngIf="currentView === 'dashboard'" class="dashboard-cards">
      <div class="welcome-box shadow-lg">
        <h2>ðŸ‘‹ Welcome back, Manager!</h2>
        <p>Hereâ€™s a quick overview of what you can do today.</p>
      </div>

  
      <div class="row g-4 mt-3">
        <div class="col-md-4" *ngFor="let item of quickActions">
          <div class="card quick-card text-center shadow-sm hover-card" (click)="setView(item.view)">
            <div class="card-body">
              <i class="bi {{item.icon}} display-5 text-primary mb-3"></i>
              <h5 class="fw-bold">{{ item.title }}</h5>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Approvals Preview -->
      <div class="card approvals-preview shadow-lg mt-5">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-clipboard-check-fill me-2"></i> Pending Approvals (Preview)</h5>
          <button class="btn btn-sm btn-gradient" (click)="setView('approvals')">View All</button>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
              <thead class="table-gradient">
                <tr>
                  <th>ID</th><th>Employee</th><th>Dates</th><th>Status</th><th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let l of leaves | slice:0:5">
                  <td>{{l.id}}</td>
                  <td>{{l.employee_name}}</td>
                  <td>{{l.start_date}} â†’ {{l.end_date}}</td>
                  <td>
                    <span class="badge bg-success" *ngIf="l.status === 'Approved'">âœ” Approved</span>
                    <span class="badge bg-danger" *ngIf="l.status === 'Rejected'">âœ– Rejected</span>
                    <span class="badge bg-warning text-dark" *ngIf="l.status === 'Pending'">âŒ› Pending</span>
                  </td>
                  <td>
                    <button class="btn btn-success btn-sm me-1" *ngIf="l.status === 'Pending'" (click)="approve(l)">âœ”</button>
                    <button class="btn btn-danger btn-sm" *ngIf="l.status === 'Pending'" (click)="reject(l)">âœ–</button>
                  </td>
                </tr>
                <tr *ngIf="(leaves | slice:0:5).length === 0">
                  <td colspan="5" class="text-muted py-3">No pending requests ðŸŽ‰</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Pending Approvals (Full View) -->
    <div *ngIf="currentView === 'approvals'" class="card p-4 mb-4 shadow-sm rounded-4">
      <h3 class="text-gradient">Pending Leave Requests</h3>
      <div class="table-responsive mt-3">
        <table class="table align-middle text-center">
          <thead>
            <tr>
              <th>ID</th><th>Employee</th><th>Dates</th><th>Reason</th><th>Status</th><th>Remark</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let l of leaves">
              <td>{{l.id}}</td>
              <td>{{l.employee_name}}</td>
              <td>{{l.start_date}} to {{l.end_date}}</td>
              <td>{{ l.reason }}<br><small class="text-muted">({{ l.leave_type }})</small></td>
              <td>
                <span class="status-approved" *ngIf="l.status === 'Approved'"><i class="bi bi-check-circle-fill me-1"></i>{{l.status}}</span>
                <span class="status-rejected" *ngIf="l.status === 'Rejected'"><i class="bi bi-x-circle-fill me-1"></i>{{l.status}}</span>
                <span class="badge bg-warning text-dark" *ngIf="l.status === 'Pending'">{{l.status}}</span>
              </td>
              <td><input [(ngModel)]="l.remarks" class="form-control form-control-sm shadow-sm" placeholder="Enter remark" /></td>
              <td>
                <button class="btn btn-success btn-sm me-2" *ngIf="l.status === 'Pending'" (click)="approve(l)">Approve</button>
                <button class="btn btn-danger btn-sm" *ngIf="l.status === 'Pending'" (click)="reject(l)">Reject</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- All Leaves -->
    <div *ngIf="currentView === 'all-leaves'" class="card p-4 mb-4 shadow-sm rounded-4">
      <h3 class="text-gradient">All Leave Requests</h3>
      <div class="table-responsive mt-3">
        <table class="table align-middle text-center">
          <thead><tr><th>ID</th><th>Employee</th><th>Dates</th><th>Reason</th><th>Status</th><th>Remark</th></tr></thead>
          <tbody>
            <tr *ngFor="let l of allLeaves">
              <td>{{l.id}}</td>
              <td>{{l.employee_name}}</td>
              <td>{{l.start_date}} to {{l.end_date}}</td>
              <td>{{ l.reason }}<br><small class="text-muted">({{ l.leave_type }})</small></td>
              <td>
                <span class="status-approved" *ngIf="l.status === 'Approved'">{{l.status}}</span>
                <span class="status-rejected" *ngIf="l.status === 'Rejected'">{{l.status}}</span>
                <span class="badge bg-warning text-dark" *ngIf="l.status === 'Pending'">{{l.status}}</span>
              </td>
              <td>{{l.remarks}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Leave Balances -->
    <div *ngIf="currentView === 'balances'" class="card p-4 mb-4 shadow-sm rounded-4">
      <h3 class="text-gradient">Employee Leave Balances</h3>
      <div class="table-responsive mt-3">
        <table class="table align-middle text-center">
          <thead><tr><th>Employee</th><th>Sick/Casual</th><th>Medical</th><th>Privileged</th></tr></thead>
          <tbody>
            <tr *ngFor="let e of employeeBalances">
              <td>{{e.username}}</td>
              <td>{{e.sick_casual}}</td>
              <td>{{e.medical}}</td>
              <td>{{e.privileged}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Create Employee + Pending Employees -->
    <div *ngIf="currentView === 'create-employee'" class="card p-4 mb-4 shadow-sm rounded-4">
      <h3 class="text-gradient">Create New Employee</h3>
      <form (ngSubmit)="createEmployee()" #empForm="ngForm" class="mt-3">
        <div class="mb-3">
          <label class="form-label">Username</label>
          <input [(ngModel)]="newEmployee.username" name="username" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input [(ngModel)]="newEmployee.password" name="password" type="password" class="form-control" required />
        </div>
        <button type="submit" class="btn btn-gradient" [disabled]="empForm.invalid">Create Employee</button>
      </form>

      <!-- âœ… Pending Employees -->
      <div class="mt-5">
        <h4 class="text-gradient">Pending Employees</h4>
        <ul class="list-group shadow-sm mt-3">
          <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let emp of pendingEmployees">
            {{ emp.username }}
            <button class="btn btn-success btn-sm" (click)="approveEmployee(emp.id)">Approve</button>
          </li>
          <li *ngIf="pendingEmployees.length === 0" class="list-group-item text-muted text-center">
            ðŸŽ‰ No pending employees
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container text-center">
      <small>Email: support@employeeportal.com | +91 9876543210</small>
      <div class="mt-2">
        <a href="#" class="text-light me-2"><i class="bi bi-facebook"></i></a>
        <a href="#" class="text-light me-2"><i class="bi bi-twitter"></i></a>
        <a href="#" class="text-light"><i class="bi bi-linkedin"></i></a>
      </div>
      <div class="mt-2">&copy; {{ currentYear }} Leave Management System</div>
    </div>
  </footer>
</div>
